name: Update Air Quality Calendar

on:
  schedule:
    # 国际标准时间(UTC) 0点, 6点, 12点, 18点 运行
    # 对应北京时间 8点, 14点, 20点, 次日2点
    - cron: '0 0,6,12,18 * * *'
  workflow_dispatch: # 允许手动点击按钮触发（方便测试）

jobs:
  build_and_deploy:
    runs-on: ubuntu-latest
    permissions:
      contents: write # 赋予写权限以便发布 Pages

    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.9'

      - name: Install dependencies
        run: |
          pip install requests pandas ics pytz

      - name: Run script
        env:  # <--- 这里是新增的
          USER_LAT: ${{ secrets.USER_LAT }}
          USER_LON: ${{ secrets.USER_LON }}
        run: python main.py

      - name: Deploy to GitHub Pages
        uses: peaceiris/actions-gh-pages@v3
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./public  # 把脚本生成的 public 文件夹发布出去
          keep_files: false
          user_name: 'GitHub Action'
          user_email: 'action@github.com'
